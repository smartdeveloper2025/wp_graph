jQuery(document).ready(function(n){WPRUS.debug&&n("body").addClass("wprus-debug");var a=function(){n(".wprus-togglable").hide(),n("."+n(".nav-tab-active").data("toggle")).show(),t(),"wprus-site"!==n(".nav-tab-active").data("toggle")||n("#postbox-container-2 .postbox.wprus-site").length?n("#sites_placeholder").hide():n("#sites_placeholder").show()},i=function(e){void 0!==e&&e.attr("disabled","disabled"),n.ajax({url:WPRUS.ajax_url,type:"POST",data:{action:"wprus_refresh_logs"},success:function(e){e.success&&(n("#logs_view").html(e.data.html),n(".logs-clean-trigger").val(e.data.clean_trigger_text))},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){t(),void 0!==e&&e.removeAttr("disabled")}})},t=function(){var e=document.getElementById("logs_view");e.scrollTop=e.scrollHeight};function e(){n("#wprus_force_login_redirect").prop("checked")?(n("#wprus_disable_login_redirect").prop("checked",!1),n("#wprus_disable_login_redirect").attr("disabled","disabled")):n("#wprus_disable_login_redirect").prop("checked")?(n("#wprus_force_login_redirect").prop("checked",!1),n("#wprus_force_login_redirect").attr("disabled","disabled")):(n("#wprus_force_login_redirect").removeAttr("disabled"),n("#wprus_disable_login_redirect").removeAttr("disabled"))}n(".nav-tab").on("click",function(e){e.preventDefault(),n(".nav-tab-active").removeClass("nav-tab-active"),n(this).addClass("nav-tab-active"),a()}),n(".wprus-container").each(function(e,t){var s=n(t);s.closest(".postbox").addClass(s.data("postbox_class"))}),a(),n("#postbox-container-2 .wprus-site").closest(".postbox").addClass("closed"),n("#normal-sortables").on("click",".handlediv, .wprus-site .hndle",function(e){e.preventDefault(),n(this).closest(".postbox").toggleClass("closed")}),n("#postbox-container-2").on("click",".deletion",function(e){e.preventDefault(),window.confirm(WPRUS.delete_site_confirm)&&n(this).closest(".wprus-site").remove()}),n("#wprus_add_trigger").on("click",function(e){e.preventDefault();var t=n("#wprus_add_value").val();if(t&&!n('.wprus-site[data-url="'+t+'"]').length)if(t.startsWith("http")){var s=n("#postbox-container-2 .wprus-site-template").clone(),r=n(".wprus-site").length;s.find("input, select").each(function(e,t){var s=n(t);s.attr("name","wprus[sites]["+r+"]"+s.data("name"))}),s.find(".wprus-container").attr("data-url",t),s.find(".hndle span").html(t),s.find('input[type="hidden"]').val(t),s.removeClass("wprus-site-template").addClass("wprus-site"),s.attr({"data-url":t,id:"site_"+r}),s.find(".wprus-select").select2({width:"100%"}),s.find(".wprus-select-tag").select2({width:"100%",tags:!0}),n("#site_template").before(s),a()}else window.alert(WPRUS.http_required)}),n(".wprus-site .wprus-select, .wprus-users .wprus-select").select2({width:"100%"}),n(".wprus-site .wprus-select-tag").select2({width:"100%",tags:!0}),n("#normal-sortables").on("change",".wprus-select-tag",function(){n(this).find("option").each(function(e,t){var s=n(t);s.attr("value",s.html())})}),n("#normal-sortables").on("change",".action-checkbox input",function(){var e=n(this),t=e.closest("tr"),s=t.find(".action-test button");t.find(".action-test-result span").hide(),e.prop("checked")?s.removeAttr("disabled"):s.attr("disabled","disabled")}),n("#normal-sortables").on("click",".action-test button",function(e){e.preventDefault();var t=n(this),s=t.parent(),r=t.closest("tr"),a={site_url:t.closest(".wprus-container").data("url"),direction:s.data("direction"),data:{username:WPRUS.username},action:"wprus_"+s.data("action")+"_notify_ping_remote"};t.attr("disabled","disabled"),r.find(".failure").hide(),r.find(".success").hide(),n.ajax({url:WPRUS.ajax_url,type:"POST",data:a,success:function(e){e.success?r.find(".success").show():(r.find(".failure").show(),setTimeout(function(){window.alert(e.data)},10))},error:function(e,t){r.find(".success").hide(),r.find(".failure").show(),setTimeout(function(){window.alert(WPRUS.undefined_error)},10),WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),i()}})}),n('input[type="password"].toggle').on("focus",function(){n(this).attr("type","text")}),n('input[type="password"].toggle').on("blur",function(){n(this).attr("type","password")}),n("#wprus_log_refresh").on("click",function(e){e.preventDefault(),i(n(this))}),n(".logs-clean-trigger").on("click",function(e){e.preventDefault();var t=n(this);t.attr("disabled","disabled"),n.ajax({url:WPRUS.ajax_url,type:"POST",data:{action:"wprus_clear_logs"},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),i()}})}),n("#wprus_export_trigger").on("click",function(e){e.preventDefault();var t=n(this),s={action:"wprus_export_users",nonce:n("#wprus_import_export_nonce").val(),offset:n("#wprus_export_offset").val(),max:n("#wprus_export_max").val(),keep_role:n("#wprus_export_keep_roles").val(),user_roles:n("#wprus_roles_export_select").val(),meta_keys:n("#wprus_metadata_export_select").val(),user_list:n("#wprus_export_users").val(),doing_import_export_operation:1};t.attr("disabled","disabled"),t.next().css("visibility","visible"),n(".export-result").removeClass("show"),n(".export-result a, .export-result-icons, .export-result-icons *").hide(),n.ajax({url:WPRUS.ajax_url,type:"POST",data:s,success:function(e){e.success?(n(".export-result-icons .success").show(),n(".export-result a").show()):e.data.file_name?(n(".export-result-icons .warning").show(),n(".export-result a").show()):n(".export-result-icons .failure").show(),e.data&&e.data.file_name&&(n(".export-result a").attr("data-file_name",e.data.file_name),n(".export-result a").attr("href",WPRUS.download_url+"?wprus_file="+e.data.file_name+"&nonce="+s.nonce)),e.data&&e.data.message&&(n("#export_message").html(e.data.message),n(".export-result-icons").show(),n(".export-result").addClass("show"))},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),t.next().css("visibility","hidden")}})}),n(".export-result a").on("click",function(e){n(this).hasClass("invalidate")?e.preventDefault():n(this).addClass("invalidated")}),n("#wprus_import_file").on("change",function(){var e=n(this);0<e.prop("files").length?(n("#wprus_import_file_filename").val(e.prop("files")[0].name),n("#wprus_import_file_trigger").removeAttr("disabled")):(n("#wprus_import_file_filename").val(""),n("#wprus_import_file_trigger").attr("disabled","disabled"))}),n("#wprus_import_file_dropzone").on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("drop",function(e){var t=n("#wprus_import_file");t.prop("files",e.originalEvent.dataTransfer.files),t.trigger("change")}),n("#wprus_import_file_trigger").on("click",function(e){e.preventDefault();var t=n(this),s=!0,r=new FormData,a=n("#wprus_import_file").prop("files")[0],i=n("#wprus_import_results .summary"),o=n("#wprus_import_results .errors");t.attr("disabled","disabled"),t.next().css("visibility","visible"),i.hide(),o.hide(),void 0!==a&&void 0!==a.type&&void 0!==a.size&&void 0!==a.name?/^([a-zA-Z0-9\-\_]*)\.dat/gm.test(a.name)||(window.alert(WPRUS.invalid_file_name),s=!1):(window.alert(WPRUS.invalid_file),s=!1),s?(r.append("action","wprus_import_users"),r.append("file",a),r.append("nonce",n("#wprus_import_export_nonce").val()),r.append("doing_import_export_operation",1),n.ajax({url:WPRUS.ajax_url,data:r,type:"POST",cache:!1,contentType:!1,processData:!1,success:function(e){e.data&&(e.data.message&&(i.html(e.data.message),i.show()),e.data.errors&&(o.html(""),n.each(e.data.errors,function(e,t){var s=n("<li>"+t+"</li>");o.append(s)}),o.show()))},error:function(e,t){i.html(WPRUS.undefined_import_error),i.show(),WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),t.next().css("visibility","hidden")}})):(t.next().css("visibility","hidden"),t.removeAttr("disabled"))}),n("#wprus_export_users").select2({width:"100%",cache:!0,closeOnSelect:!1,ajax:{url:WPRUS.ajax_url,dataType:"json",language:WPRUS.locale,cache:!1,type:"POST",data:function(e){return{q:e.term,page:e.page||1,action:"wprus_get_usernames",nonce:n("#wprus_import_export_nonce").val()}},processResults:function(e){var s=[];return e&&e.success&&e.data&&n.each(e.data.users,function(e,t){s.push({id:t.username,text:t.username})}),{results:s,pagination:{more:e.data.more}}}}}),n(".wprus-help-title").on("click",function(e){e.preventDefault(),n(this).next().slideToggle(200)}),n("#wprus_force_login_redirect, #wprus_disable_login_redirect").on("change",function(){e()}),e(),n(".wprus-ui-wait").show()});